---
title: å¾®ä¿¡å…¬ä¼—å·å®ç°æ¯æ—¥æ¨é€
date: 2023-01-06
breadcrumb: false
pageInfo: false
category:
- å¾®ä¿¡å…¬ä¼—å·
tag:
- å¾®ä¿¡
---
## å‰è¨€

æœ€è¿‘é€›è®ºå›çš„æ—¶å€™çœ‹åˆ°å¾ˆå¤šæ–‡ç« éƒ½åœ¨è®²ä½¿ç”¨å¾®ä¿¡æµ‹è¯•å·æ¥å®ç°æ¯æ—¥çš„æ¶ˆæ¯æ¨é€ï¼Œäºæ˜¯è‡ªå·±ä¹Ÿç®€å•å­¦ä¹ äº†ä¸€ä¸‹ï¼Œç„¶åå°è¯•ç€åšç€ç©ç©ã€‚

## è´¦å·å’Œç›¸å…³APIç”³è¯·
### æµ‹è¯•è´¦å·ç”³è¯·
é¦–å…ˆéœ€è¦ç”³è¯·ä¸€ä¸‹å¾®ä¿¡çš„[å…¬ä¼—å¹³å°æµ‹è¯•è´¦å·](https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login),ç”³è¯·å®Œæˆä¹‹åå°±åœ¨å¯ä»¥çœ‹åˆ°è‡ªå·±çš„appIDå’Œappsecret

![20230107220843](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107220843.png)

### å¾®ä¿¡ç›¸å…³çš„API

``` YML
  #tokenè·å–
  tokenApi: https://api.weixin.qq.com/cgi-bin/token
  #è·å–ç”¨æˆ·åˆ—è¡¨
  userListApi: https://api.weixin.qq.com/cgi-bin/user/get
  #è·å–ç”¨æˆ·ä¿¡æ¯
  userInfoApi: https://api.weixin.qq.com/cgi-bin/user/info
```
æ¨¡æ¿IDï¼Œè¿™ä¸ªå°±æ˜¯ç­‰ä¸‹å‘é€çš„æ¶ˆæ¯çš„ä¸€ä¸ªæ¨¡æ¿ï¼Œæˆ‘ä»¬å‘å¾®ä¿¡çš„æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼Œå®ƒæ¥æ”¶åˆ°ä¹‹åå°±ä¼šæ ¹æ®æ¨¡æ¿IDåŒ¹é…åˆ°ç›¸åº”çš„æ¨¡æ¿ï¼Œç„¶åæŒ‰ç…§æ¨¡æ¿é…ç½®çš„å‚æ•°æ¥ç»„æˆä¸€ä¸ªæ¨¡æ¿ä¿¡æ¯ï¼Œæ¨¡æ¿IDåªéœ€è¦è‡ªå·±æ–°å¢ä¸€ä¸ªæµ‹è¯•æ¨¡æ¿åå°±ä¼šç»™ä½ ä¸€ä¸ªID

![20230107222603](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107222603.png)

### å¤©æ°”API

ä¸ºäº†å®ç°æ¯æ—¥çš„å¤©æ°”æ¨é€å°±éœ€è¦ä½¿ç”¨åˆ°æ¥æ”¶å¤©æ°”çš„apiï¼Œæˆ‘é€‰æ‹©çš„æ˜¯[å’Œé£å¤©æ°”](https://dev.qweather.com/)çš„apiæ¥å®ç°å¤©æ°”çš„æŸ¥è¯¢å’Œå¤©æ°”æŒ‡æ•°çš„è·å–ï¼Œç”³è¯·ä¸€ä¸ªå’Œé£å¤©æ°”çš„è´¦å·ï¼Œç„¶ååœ¨åå°åˆ›å»ºé¡¹ç›®ï¼Œå°±å¯ä»¥è·å–ä¸€ä¸ªkeyï¼Œè¿™ä¸ªkeyå°±æ˜¯ç”¨æ¥å‘é€å¤©æ°”è¯·æ±‚å¿…é¡»çš„å‚æ•°


![20230107221727](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107221727.png)

![20230107223224](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107223224.png)

```YML
  å½“å‰å¤©æ°”çš„api: https://devapi.qweather.com/v7/weather/now/
  å¤©æ°”æŒ‡æ•°çš„api: https://devapi.qweather.com/v7/indices/1d/
```

### ä¸€è¨€API

æ¯æ—¥å“²å­¦ğŸ˜…ï¼Œä½¿ç”¨[ä¸€è¨€](https://developer.hitokoto.cn/)ï¼Œæ¥å®ç°æ¯æ—¥å“²å­¦æ¨é€

APIé…ç½®å®Œæˆåæˆ‘ä»¬é¡¹ç›®çš„é…ç½®æ–‡ä»¶å°±æ˜¯è¿™ä¸ªæ ·å­

```YML


wx:
  appID: ç”³è¯·çš„è´¦å·ID
  appsecret: ç”³è¯·çš„è´¦å·KEY
  templateId: æ¶ˆæ¯æ¨¡æ¿çš„ID
  #tokenè·å–
  tokenApi: https://api.weixin.qq.com/cgi-bin/token
  #è·å–ç”¨æˆ·åˆ—è¡¨
  userListApi: https://api.weixin.qq.com/cgi-bin/user/get
  #è·å–ç”¨æˆ·ä¿¡æ¯
  userInfoApi: https://api.weixin.qq.com/cgi-bin/user/info

#å’Œé£å¤©æ°”api
api:
  weatherApi: https://devapi.qweather.com/v7/weather/now/
  indicesApi: https://devapi.qweather.com/v7/indices/1d/
  cityid: è·å–å¤©æ°”çš„åŸå¸‚ID
  cityname: åŸå¸‚çš„åå­—
  #å¤©æ°”æŒ‡æ•°type
  #https://dev.qweather.com/docs/resource/indices-info/
  type: 1,3,5,16 #å¤©æ°”æŒ‡æ•°çš„ç±»å‹
  key: è¯·æ±‚æ¥å£éœ€è¦ä½¿ç”¨çš„api
yiyan:
  api: "https://v1.hitokoto.cn/?c=k&encode=text"


```

## æ¨é€ä»£ç å®ç°

### pom.xml

``` xml

<dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- å¾®ä¿¡æµ‹è¯•å…¬ä¼—å·ä¸‰æ–¹å¯¹æ¥åŒ… -->
        <dependency>
            <groupId>com.github.binarywang</groupId>
            <artifactId>weixin-java-mp</artifactId>
            <version>3.3.0</version>
        </dependency>
        <!--Hutoolå·¥å…·åŒ…-->
        <dependency>
            <groupId>cn.hutool</groupId>
            <artifactId>hutool-all</artifactId>
            <version>5.7.16</version>
        </dependency>

```

### è·å–access_token

access_tokenæ˜¯å…¬ä¼—å·çš„å…¨å±€å”¯ä¸€æ¥å£è°ƒç”¨å‡­æ®ï¼Œå…¬ä¼—å·è°ƒç”¨å„æ¥å£æ—¶éƒ½éœ€ä½¿ç”¨access_tokenã€‚æ‰€ä»¥æˆ‘ä»¬å†™ä¸€ä¸ªè·å–accesstokençš„æ–¹æ³•

![20230107224950](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107224950.png)

``` java

@Component
public class GetAccessToken {
    @Value("${wx.appID}")
    private String appID;

    @Value("${wx.appsecret}")
    private String appsecret;

    @Value("${wx.tokenApi}")
    private String tokenApi;

    public String getToken(){
        HashMap<String, Object> param = new HashMap<>();
        param.put("grant_type","client_credential");
        param.put("appid",appID);
        param.put("secret",appsecret);
        String response = HttpUtil.get(tokenApi, param);
        JSONObject jsonObject = JSONUtil.parseObj(response);
        //{"access_token":"ACCESS_TOKEN","expires_in":7200}
        return jsonObject.get("access_token").toString();
    }

}

```

### è·å–å…³æ³¨ç”¨æˆ·çš„API

```java

@Component
@Slf4j
public class UserUtil {

    @Value("${wx.appID}")
    private String appID;

    @Value("${wx.appsecret}")
    private String appsecret;

    @Value("${wx.userListApi}")
    private String userListApi;

    @Value("${wx.userInfoApi}")
    private String userInfoApi;

    @Autowired
    private GetAccessToken getAccessToken;

    public List<String> getAllUser(String access_token){

        HashMap<String, Object> param = new HashMap<>();
        param.put("access_token",access_token);

        String response = HttpUtil.get(userListApi, param);

        JSONObject jsonObject = JSONUtil.parseObj(response);
        JSONObject openidObj = (JSONObject) jsonObject.get("data");
        List<String> openid = (List<String>) openidObj.get("openid");

        log.info(openid.toString());

        return openid;

    }
    public List<String> getUserInfo(String access_token,String openid){

        HashMap<String, Object> param = new HashMap<>();
        param.put("access_token",access_token);
        param.put("openid",openid);
        param.put("lang","zh_CN");

        String response = HttpUtil.get(userInfoApi, param);

        JSONObject jsonObject = JSONUtil.parseObj(response);

        log.info(openid.toString());

        return null;

    }
}


```
### å¤©æ°”çš„ç›¸å…³å·¥å…·ç±»å’Œå®ä½“ç±»

å¤©æ°”å®ä½“ç±»
```java

@Data
@AllArgsConstructor
@ToString
public class Weather {

    private String city;

    //å¤©æ°”
    private String text;

    //é£å‘
    private String windDir;

    //æ¸©åº¦
    private String temp;

    //ä½“æ„Ÿæ¸©åº¦
    private String feelsLike;

    //ç©ºæ°”æ¹¿åº¦
    private String humidity;

}
```

å¤©æ°”æŒ‡æ•°å®ä½“ç±»
```java
@Data
@AllArgsConstructor
public class Indices {
    //è¿åŠ¨æŒ‡æ•° 1
    private String sport;

    //è¿åŠ¨å»ºè®®
    private String sporttext;

    //ç©¿è¡£æŒ‡æ•° 3
    private String wear;

    //ç©¿è¡£å»ºè®®
    private String weartext;

    //é˜²æ™’æŒ‡æ•° 16
    private String skin;

    //é˜²æ™’å»ºè®®
    private String skintext;
}
```

``` java

@Component
@Slf4j
public class WeatherUtil {

    @Value("${api.weatherApi}")
    private String weatherApi;

    @Value("${api.indicesApi}")
    private String indicesApi;

    @Value("${api.cityid}")
    private String citycode;

    @Value("${api.cityname}")
    private String cityname;

    @Value("${api.key}")
    private String key;

    @Value("${api.type}")
    private String type;


    public Weather getWeather(String citycode){

        HashMap<String, Object> param = new HashMap<>();
        param.put("location",citycode);
        param.put("key",key);
        String response = HttpUtil.get(weatherApi, param);
        JSONObject jsonObject = JSONUtil.parseObj(response);
        Weather weather = (Weather)jsonObject.get("now");
        return weather;
    }

    public Weather getWeather(){

        HashMap<String, Object> param = new HashMap<>();
        param.put("location",citycode);
        param.put("key",key);
        String response = HttpUtil.get(weatherApi, param);
        JSONObject jsonObject = JSONUtil.parseObj(response);
        JSONObject weatherobj = (JSONObject) jsonObject.get("now");
        Weather weather = new Weather(cityname,weatherobj.get("text").toString(),weatherobj.get("windDir").toString(),
                weatherobj.get("temp").toString(),
                weatherobj.get("feelsLike").toString(),weatherobj.get("humidity").toString());
        log.info(weather.toString());
        return weather;
    }

    public Indices getIndices(){

        HashMap<String, Object> param = new HashMap<>();
        param.put("location",citycode);
        param.put("key",key);
        param.put("type",type);
        String response = HttpUtil.get(indicesApi, param);
        JSONObject jsonObject = JSONUtil.parseObj(response);
        List<JSONObject> list = (List) jsonObject.get("daily");
        Indices indices = new Indices(list.get(0).get("name").toString(),list.get(0).get("text").toString(),
                list.get(1).get("name").toString(),list.get(1).get("text").toString(),
                list.get(2).get("name").toString(),list.get(2).get("text").toString());
        log.info(indices.toString());
        return indices;
    }

}

```


### SendController

``` java
@Component
@Slf4j
public class SendController {

    @Value("${wx.appID}")
    private String appID;
    @Value("${wx.appsecret}")
    private String appsecret;
    @Value("${wx.templateId}")
    private String templateId;

    @Autowired
    private WeatherUtil weatherUtil;

    @Autowired
    private YiyanUtil yiyanUtil;
æœ€è¿‘é€›è®ºå›çš„æ—¶å€™çœ‹åˆ°å¾ˆå¤šæ–‡ç« éƒ½åœ¨è®²ä½¿ç”¨å¾®ä¿¡æµ‹è¯•å·æ¥å®ç°æ¯æ—¥çš„æ¶ˆæ¯æ¨é€ï¼Œäºæ˜¯è‡ªå·±ä¹Ÿç®€å•å­¦ä¹ äº†ä¸€ä¸‹ï¼Œç„¶åå°è¯•ç€åšç€ç©ç©ã€‚

## è´¦å·å’Œç›¸å…³APIç”³è¯·
### æµ‹è¯•è´¦å·ç”³è¯·
é¦–å…ˆéœ€è¦ç”³è¯·ä¸€ä¸‹å¾®ä¿¡çš„[å…¬ä¼—å¹³å°æµ‹è¯•è´¦å·](https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login),ç”³è¯·å®Œæˆä¹‹åå°±åœ¨å¯ä»¥çœ‹åˆ°è‡ªå·±çš„appIDå’Œappsecret

![20230107220843](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107220843.png)

### å¾®ä¿¡ç›¸å…³çš„API

``` YML
  #tokenè·å–
  tokenApi: https://api.weixin.qq.com/cgi-bin/token
  #è·å–ç”¨æˆ·åˆ—è¡¨
  userListApi: https://api.weixin.qq.com/cgi-bin/user/get
  #è·å–ç”¨æˆ·ä¿¡æ¯
  userInfoApi: https://api.weixin.qq.com/cgi-bin/user/info
```
æ¨¡æ¿IDï¼Œè¿™ä¸ªå°±æ˜¯ç­‰ä¸‹å‘é€çš„æ¶ˆæ¯çš„ä¸€ä¸ªæ¨¡æ¿ï¼Œæˆ‘ä»¬å‘å¾®ä¿¡çš„æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼Œå®ƒæ¥æ”¶åˆ°ä¹‹åå°±ä¼šæ ¹æ®æ¨¡æ¿IDåŒ¹é…åˆ°ç›¸åº”çš„æ¨¡æ¿ï¼Œç„¶åæŒ‰ç…§æ¨¡æ¿é…ç½®çš„å‚æ•°æ¥ç»„æˆä¸€ä¸ªæ¨¡æ¿ä¿¡æ¯ï¼Œæ¨¡æ¿IDåªéœ€è¦è‡ªå·±æ–°å¢ä¸€ä¸ªæµ‹è¯•æ¨¡æ¿åå°±ä¼šç»™ä½ ä¸€ä¸ªID

![20230107222603](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107222603.png)

### å¤©æ°”API

ä¸ºäº†å®ç°æ¯æ—¥çš„å¤©æ°”æ¨é€å°±éœ€è¦ä½¿ç”¨åˆ°æ¥æ”¶å¤©æ°”çš„apiï¼Œæˆ‘é€‰æ‹©çš„æ˜¯[å’Œé£å¤©æ°”](https://dev.qweather.com/)çš„apiæ¥å®ç°å¤©æ°”çš„æŸ¥è¯¢å’Œå¤©æ°”æŒ‡æ•°çš„è·å–ï¼Œç”³è¯·ä¸€ä¸ªå’Œé£å¤©æ°”çš„è´¦å·ï¼Œç„¶ååœ¨åå°åˆ›å»ºé¡¹ç›®ï¼Œå°±å¯ä»¥è·å–ä¸€ä¸ªkeyï¼Œè¿™ä¸ªkeyå°±æ˜¯ç”¨æ¥å‘é€å¤©æ°”è¯·æ±‚å¿…é¡»çš„å‚æ•°


![20230107221727](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107221727.png)

![20230107223224](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107223224.png)

```YML
  å½“å‰å¤©æ°”çš„api: https://devapi.qweather.com/v7/weather/now/
  å¤©æ°”æŒ‡æ•°çš„api: https://devapi.qweather.com/v7/indices/1d/
```

### ä¸€è¨€API

æ¯æ—¥å“²å­¦ğŸ˜…ï¼Œä½¿ç”¨[ä¸€è¨€](https://developer.hitokoto.cn/)ï¼Œæ¥å®ç°æ¯æ—¥å“²å­¦æ¨é€

APIé…ç½®å®Œæˆåæˆ‘ä»¬é¡¹ç›®çš„é…ç½®æ–‡ä»¶å°±æ˜¯è¿™ä¸ªæ ·å­

```YML


wx:
  appID: ç”³è¯·çš„è´¦å·ID
  appsecret: ç”³è¯·çš„è´¦å·KEY
  templateId: æ¶ˆæ¯æ¨¡æ¿çš„ID
  #tokenè·å–
  tokenApi: https://api.weixin.qq.com/cgi-bin/token
  #è·å–ç”¨æˆ·åˆ—è¡¨
  userListApi: https://api.weixin.qq.com/cgi-bin/user/get
  #è·å–ç”¨æˆ·ä¿¡æ¯
  userInfoApi: https://api.weixin.qq.com/cgi-bin/user/info

#å’Œé£å¤©æ°”api
api:
  weatherApi: https://devapi.qweather.com/v7/weather/now/
  indicesApi: https://devapi.qweather.com/v7/indices/1d/
  cityid: è·å–å¤©æ°”çš„åŸå¸‚ID
  cityname: åŸå¸‚çš„åå­—
  #å¤©æ°”æŒ‡æ•°type
  #https://dev.qweather.com/docs/resource/indices-info/
  type: 1,3,5,16 #å¤©æ°”æŒ‡æ•°çš„ç±»å‹
  key: è¯·æ±‚æ¥å£éœ€è¦ä½¿ç”¨çš„api
yiyan:
  api: "https://v1.hitokoto.cn/?c=k&encode=text"


```

## æ¨é€ä»£ç å®ç°

### pom.xml

``` xml

<dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>

        <!-- å¾®ä¿¡æµ‹è¯•å…¬ä¼—å·ä¸‰æ–¹å¯¹æ¥åŒ… -->
        <dependency>
            <groupId>com.github.binarywang</groupId>
            <artifactId>weixin-java-mp</artifactId>
            <version>3.3.0</version>
        </dependency>
        <!--Hutoolå·¥å…·åŒ…-->
        <dependency>
            <groupId>cn.hutool</groupId>
            <artifactId>hutool-all</artifactId>
            <version>5.7.16</version>
        </dependency>

```

### è·å–access_token

access_tokenæ˜¯å…¬ä¼—å·çš„å…¨å±€å”¯ä¸€æ¥å£è°ƒç”¨å‡­æ®ï¼Œå…¬ä¼—å·è°ƒç”¨å„æ¥å£æ—¶éƒ½éœ€ä½¿ç”¨access_tokenã€‚æ‰€ä»¥æˆ‘ä»¬å†™ä¸€ä¸ªè·å–accesstokençš„æ–¹æ³•

![20230107224950](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107224950.png)

``` java

@Component
public class GetAccessToken {
    @Value("${wx.appID}")
    private String appID;

    @Value("${wx.appsecret}")
    private String appsecret;

    @Value("${wx.tokenApi}")
    private String tokenApi;

    public String getToken(){
        HashMap<String, Object> param = new HashMap<>();
        param.put("grant_type","client_credential");
        param.put("appid",appID);
        param.put("secret",appsecret);
        String response = HttpUtil.get(tokenApi, param);
        JSONObject jsonObject = JSONUtil.parseObj(response);
        //{"access_token":"ACCESS_TOKEN","expires_in":7200}
        return jsonObject.get("access_token").toString();
    }

}

```

### è·å–å…³æ³¨ç”¨æˆ·çš„API

```java

@Component
@Slf4j
public class UserUtil {

    @Value("${wx.appID}")
    private String appID;

    @Value("${wx.appsecret}")
    private String appsecret;

    @Value("${wx.userListApi}")
    private String userListApi;

    @Value("${wx.userInfoApi}")
    private String userInfoApi;

    @Autowired
    private GetAccessToken getAccessToken;

    public List<String> getAllUser(String access_token){

        HashMap<String, Object> param = new HashMap<>();
        param.put("access_token",access_token);

        String response = HttpUtil.get(userListApi, param);

        JSONObject jsonObject = JSONUtil.parseObj(response);
        JSONObject openidObj = (JSONObject) jsonObject.get("data");
        List<String> openid = (List<String>) openidObj.get("openid");

        log.info(openid.toString());

        return openid;

    }
    public List<String> getUserInfo(String access_token,String openid){

        HashMap<String, Object> param = new HashMap<>();
        param.put("access_token",access_token);
        param.put("openid",openid);
        param.put("lang","zh_CN");

        String response = HttpUtil.get(userInfoApi, param);

        JSONObject jsonObject = JSONUtil.parseObj(response);

        log.info(openid.toString());

        return null;

    }
}


```
### å¤©æ°”çš„ç›¸å…³å·¥å…·ç±»å’Œå®ä½“ç±»

å¤©æ°”å®ä½“ç±»
```java

@Data
@AllArgsConstructor
@ToString
public class Weather {

    private String city;

    //å¤©æ°”
    private String text;

    //é£å‘
    private String windDir;

    //æ¸©åº¦
    private String temp;

    //ä½“æ„Ÿæ¸©åº¦
    private String feelsLike;

    //ç©ºæ°”æ¹¿åº¦
    private String humidity;

}
```

å¤©æ°”æŒ‡æ•°å®ä½“ç±»
```java
@Data
@AllArgsConstructor
public class Indices {
    //è¿åŠ¨æŒ‡æ•° 1
    private String sport;

    //è¿åŠ¨å»ºè®®
    private String sporttext;

    //ç©¿è¡£æŒ‡æ•° 3
    private String wear;

    //ç©¿è¡£å»ºè®®
    private String weartext;

    //é˜²æ™’æŒ‡æ•° 16
    private String skin;

    //é˜²æ™’å»ºè®®
    private String skintext;
}
```

``` java

@Component
@Slf4j
public class WeatherUtil {

    @Value("${api.weatherApi}")
    private String weatherApi;

    @Value("${api.indicesApi}")
    private String indicesApi;

    @Value("${api.cityid}")
    private String citycode;

    @Value("${api.cityname}")
    private String cityname;

    @Value("${api.key}")
    private String key;

    @Value("${api.type}")
    private String type;


    public Weather getWeather(String citycode){

        HashMap<String, Object> param = new HashMap<>();
        param.put("location",citycode);
        param.put("key",key);
        String response = HttpUtil.get(weatherApi, param);
        JSONObject jsonObject = JSONUtil.parseObj(response);
        Weather weather = (Weather)jsonObject.get("now");
        return weather;
    }

    public Weather getWeather(){

        HashMap<String, Object> param = new HashMap<>();
        param.put("location",citycode);
        param.put("key",key);
        String response = HttpUtil.get(weatherApi, param);
        JSONObject jsonObject = JSONUtil.parseObj(response);
        JSONObject weatherobj = (JSONObject) jsonObject.get("now");
        Weather weather = new Weather(cityname,weatherobj.get("text").toString(),weatherobj.get("windDir").toString(),
                weatherobj.get("temp").toString(),
                weatherobj.get("feelsLike").toString(),weatherobj.get("humidity").toString());
        log.info(weather.toString());
        return weather;
    }

    public Indices getIndices(){

        HashMap<String, Object> param = new HashMap<>();
        param.put("location",citycode);
        param.put("key",key);
        param.put("type",type);
        String response = HttpUtil.get(indicesApi, param);
        JSONObject jsonObject = JSONUtil.parseObj(response);
        List<JSONObject> list = (List) jsonObject.get("daily");
        Indices indices = new Indices(list.get(0).get("name").toString(),list.get(0).get("text").toString(),
                list.get(1).get("name").toString(),list.get(1).get("text").toString(),
                list.get(2).get("name").toString(),list.get(2).get("text").toString());
        log.info(indices.toString());
        return indices;
    }

}

```


### SendController

``` java
@Component
@Slf4j
public class SendController {

    @Value("${wx.appID}")
    private String appID;
    @Value("${wx.appsecret}")
    private String appsecret;
    @Value("${wx.templateId}")
    private String templateId;

    @Autowired
    private WeatherUtil weatherUtil;

    @Autowired
    private YiyanUtil yiyanUtil;



    public void push(String openid){
        
        WxMpInMemoryConfigStorage wxStorage = new WxMpInMemoryConfigStorage();
        wxStorage.setAppId(appID);
        wxStorage.setSecret(appsecret);
        WxMpService wxMpService = new WxMpServiceImpl();
        wxMpService.setWxMpConfigStorage(wxStorage);
        String today = FormatTime.format();

        ChineseDate chinese = new ChineseDate(new Date());
        //String chineseDate = "å†œå† "+chinese.toString();

        Weather weather = weatherUtil.getWeather();
        Indices indices = weatherUtil.getIndices();

        String yiyan = YiyanUtil.hitokoto();
    public void push(String openid){
        
        WxMpInMemoryConfigStorage wxStorage = new WxMpInMemoryConfigStorage();
        wxStorage.setAppId(appID);
        wxStorage.setSecret(appsecret);
        WxMpService wxMpService = new WxMpServiceImpl();
        wxMpService.setWxMpConfigStorage(wxStorage);
        String today = FormatTime.format();

        ChineseDate chinese = new ChineseDate(new Date());
        //String chineseDate = "å†œå† "+chinese.toString();

        Weather weather = weatherUtil.getWeather();
        Indices indices = weatherUtil.getIndices();

        String yiyan = YiyanUtil.hitokoto();


        
        WxMpTemplateMessage templateMessage = WxMpTemplateMessage.builder()
                .toUser(openid)
                .templateId(templateId)
                .build();
        templateMessage.addData(new WxMpTemplateData("smile","\uD83D\uDE03","#00BFFF"));
        templateMessage.addData(new WxMpTemplateData("today",today,"#4EEE94"));
        templateMessage.addData(new WxMpTemplateData("chineseDate",chinese.toString(),"#a0ee32"));
        templateMessage.addData(new WxMpTemplateData("city",weather.getCity()+"","#7A378B"));
        templateMessage.addData(new WxMpTemplateData("wendu",weather.getTemp()+"åº¦"+"","#3aeede"));
        templateMessage.addData(new WxMpTemplateData("tiganwendu",weather.getFeelsLike()+"åº¦"+"","#7B68EE"));
        templateMessage.addData(new WxMpTemplateData("weather",weather.getText()+"","#eea5e1"));
        templateMessage.addData(new WxMpTemplateData("windDir",weather.getWindDir()+"","#caee53"));
        templateMessage.addData(new WxMpTemplateData("humidity",weather.getHumidity()+"","#eed42e"));

        templateMessage.addData(new WxMpTemplateData("sport",indices.getSport()+"","#CD3278"));
        templateMessage.addData(new WxMpTemplateData("sporttext",indices.getSporttext(),"#14cd15"));

        templateMessage.addData(new WxMpTemplateData("wear",indices.getWear()+"","#4acdae"));
        templateMessage.addData(new WxMpTemplateData("weartext",indices.getWeartext(),"#16a4cd"));

        templateMessage.addData(new WxMpTemplateData("skin",indices.getSkin()+"","#757fcd"));
        templateMessage.addData(new WxMpTemplateData("skintext",indices.getSkintext(),"#93cd61"));

        templateMessage.addData(new WxMpTemplateData("yiyan",yiyan,"#FF8247"));
        try {
            log.info(templateMessage.toJson());
            wxMpService.getTemplateMsgService().sendTemplateMsg(templateMessage);
        
        } catch (Exception e) {
            log.error("æ¨é€å¤±è´¥ï¼š" + e.getMessage());
            e.printStackTrace();
        }
    }

}

```
ç°åœ¨æ¶ˆæ¯æ¨é€åŸºæœ¬å®Œæˆï¼Œå†™ä¸€ä¸ªæµ‹è¯•æ–¹æ³•å°è¯•æ˜¯å¦èƒ½å¤Ÿæ¨é€æ¶ˆæ¯

::: info

~~å¾®ä¿¡æµ‹è¯•å·çš„æ¨é€å¥½åƒå¶å°”ä¼šæœ‰æ¶ˆæ¯å»¶è¿Ÿ~~ ä¸æ˜¯å¾®ä¿¡æ¶ˆæ¯å»¶è¿Ÿï¼Œæˆ‘æ˜¯ç”¨çš„dockeréƒ¨ç½²çš„ï¼Œæ˜¯å› ä¸ºdockerçš„æ—¶é—´å’Œå®¿ä¸»æœºçš„æ—¶é—´æœ‰8ä¸ªå°æ—¶çš„æ—¶é—´å·®

:::
```java
@Test
    void pushMessage(){
        sendController.push("ç”¨æˆ·çš„id");
    }

```
![20230107230318](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107230318.png)

![20230107230955](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/20230107230955.png)

æ³¨æ„ä¸€ä¸‹ï¼Œè¿™é‡Œç”µè„‘ç«¯å’Œæ‰‹æœºç«¯çš„æ˜¾ç¤ºç¨å¾®æœ‰ç‚¹åŒºåˆ«ï¼Œä¸çŸ¥é“æ˜¯æœ¬æ¥å°±æœ‰åŒºåˆ«è¿˜æ˜¯å•¥é—®é¢˜ï¼Œç”µè„‘ç«¯å¶å°”å°±ä¼šæœ‰ç‚¹æ’ç‰ˆä¹±äº†çš„æ„Ÿè§‰

![ead809f9a4889c91325346e55a47aab](https://blog-1253887276.cos.ap-chongqing.myqcloud.com/vscodeblog/ead809f9a4889c91325346e55a47aab.jpg)

### å®šæ—¶å‘é€

ä¸ºäº†èƒ½è®©æˆ‘ä»¬çš„å…¬ä¼—å·èƒ½å¤Ÿå®ç°æ¯å¤©å®šæ—¶å‘é€æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºç¨‹åºåŠ ä¸Šå®šæ—¶ä»»åŠ¡
é¦–å…ˆåœ¨å…¥å£ç¨‹åºåŠ ä¸Š`@EnableScheduling`æ³¨è§£

åœ¨æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶é‡Œé¢åŠ ä¸Šä¸€ä¸ª`cron`è¡¨è¾¾å¼ï¼Œç”¨æ¥å‘Šè¯‰ç¨‹åºæˆ‘ä»¬å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œè§„åˆ™

```YML
#æ¯å¤©æ—©ä¸Š7:30æ‰§è¡Œ
TimerTask:
  cron: 0 30 7 * * ?

```

ç„¶åå†™ä¸€ä¸ªå®šæ—¶ä»»åŠ¡

```java

@Component
@Slf4j
public class ScheduledPush {

    @Autowired
    private  SendController sendController;

    @Autowired
    private UserUtil userUtil;

    @Autowired
    private GetAccessToken getAccessToken;

    @Scheduled(cron = "${TimerTask.cron}")
    public void push(){
        List<String> openids = userUtil.getAllUser(getAccessToken.getToken());
        openids.stream().forEach(System.out::println);
        openids.stream().forEach(openid -> sendController.push(openid));
    }
}

```
### å†™åœ¨æœ€å

å½“å®Œæˆä»¥ä¸Šæ­¥éª¤ä¹‹åå°±å¯ä»¥å°†ç¨‹åºæ‰“åŒ…æ”¾å…¥æœåŠ¡å™¨è¿è¡Œäº†ã€‚

ä¼˜åŒ–ï¼š

å¯ä»¥åœ¨å…³æ³¨ä¹‹åè®©å…¶è¾“å…¥ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œå­˜å…¥æ•°æ®åº“ä¹‹å†…ï¼Œç„¶åå°±å¯ä»¥æ ¹æ®æ¯ä¸ªç”¨æˆ·æ¨é€ä¸åŒçš„ä¿¡æ¯ã€‚

åé¢æ–°å¢äº†ä¸€ä¸ªé‚®ä»¶å‘é€çš„åŠŸèƒ½æ¥ç›‘æµ‹æ¯å¤©æ˜¯å¦æŒ‰æ—¶å‘é€äº†æ¶ˆæ¯

